#!/bin/bash
# Pre-commit hook to check for problematic patterns

# Check if any running mdbook serve processes (not via dev-server.sh)
if pgrep -f "mdbook serve" | while read pid; do
    # Check if this process is NOT a child of dev-server.sh
    if ! pgrep -P $pid -f "dev-server" > /dev/null 2>&1; then
        return 0  # Found a direct mdbook serve
    fi
    done; then
    echo "❌ ERROR: Direct 'mdbook serve' process detected!"
    echo ""
    echo "Please stop 'mdbook serve' and use './dev-server.sh' instead."
    echo "Run: pkill -f 'mdbook serve'"
    echo "Then: ./dev-server.sh"
    echo ""
    exit 1
fi

# Check for common mistakes in files being committed
git diff --cached --name-only | while read file; do
    if [[ "$file" == *.sh ]] || [[ "$file" == *.md ]]; then
        # Check for direct mdbook serve commands in scripts
        if git diff --cached "$file" | grep -q "mdbook serve" | grep -v "dev-server.sh"; then
            echo "⚠️  Warning: Found 'mdbook serve' reference in $file"
            echo "   Consider using './dev-server.sh' instead"
        fi
    fi
done

exit 0