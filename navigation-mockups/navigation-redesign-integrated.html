<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Integrated Navigation with Relationships Panel</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            display: flex;
            height: 100vh;
        }
        
        /* Three-panel layout */
        .container {
            display: flex;
            width: 100%;
            height: 100%;
            gap: 1px;
            background: #ddd;
        }
        
        /* Left Sidebar */
        .left-sidebar {
            width: var(--left-width, 300px);
            min-width: 200px;
            max-width: 500px;
            background: white;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #dee2e6;
            position: relative;
        }
        
        .sidebar-header {
            padding: 14px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 2px solid #dee2e6;
            position: relative;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .sidebar-title {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
        }
        
        .order-icons-alt {
            display: flex;
            gap: 2px;
        }
        
        /* Search box */
        .search-box {
            width: 100%;
            padding: 8px 12px;
            border: 1.5px solid #e9ecef;
            border-radius: 6px;
            font-size: 13px;
            margin-bottom: 12px;
            box-sizing: border-box;
            transition: all 0.2s;
            background: white;
            box-shadow: 0 1px 2px rgba(0,0,0,0.04);
        }
        
        .search-box:focus {
            outline: none;
            border-color: #0969da;
            box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.1);
        }
        
        /* Control groups */
        .control-group {
            margin-bottom: 10px;
        }
        
        .control-label {
            font-size: 10px;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        
        /* Order icon buttons */
        .order-icons {
            display: flex;
            gap: 2px;
        }
        
        .order-icon {
            width: 22px;
            height: 22px;
            padding: 0;
            border: 1.5px solid #dee2e6;
            background: white;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            color: #495057;
            font-weight: 600;
        }
        
        .order-icon:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
        }
        
        .order-icon.active {
            background: #0969da;
            color: white;
            border-color: #0969da;
        }
        
        /* View selector - now 3 buttons */
        .view-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
        }
        
        .view-btn {
            padding: 6px 8px;
            font-size: 11px;
            font-weight: 500;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .view-btn:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
        }
        
        .view-btn.active {
            background: #0969da;
            color: white;
            border-color: #0969da;
        }
        
        .view-btn.active:hover {
            background: #0550ae;
        }
        
        
        /* Floating stats bar */
        .stats {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            font-size: 10px;
            color: #6b7280;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border-top: 1px solid #e5e7eb;
            text-align: center;
            z-index: 5;
        }
        
        .stats #count {
            font-weight: 600;
            color: #1f2937;
        }
        
        /* Navigation list */
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            padding-bottom: 40px; /* Space for floating stats */
            background: #fefefe;
        }
        
        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .nav-list li {
            padding: 8px 10px;
            font-size: 12px;
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 2px;
            transition: all 0.2s ease;
            display: block;
            border: 1px solid transparent;
            position: relative;
            background: white;
        }
        
        .nav-list li:hover {
            background: #f8f9fa;
            border-color: #e9ecef;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .nav-list li.active {
            background: #e7f1ff;
            border-left: 3px solid #0969da;
            padding-left: 7px;
            box-shadow: 0 1px 3px rgba(9, 105, 218, 0.1);
            font-weight: 500;
        }
        
        .nav-list li.active:hover {
            transform: none;
        }
        
        .nav-list .number {
            font-weight: 600;
            color: #0969da;
            margin-right: 6px;
            font-size: 11px;
        }
        
        .nav-list .year-tag {
            margin-left: auto;
            color: #9ca3af;
            font-size: 10px;
            font-weight: 500;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            background: white;
            padding: 40px;
            overflow-y: auto;
        }
        
        .content-header {
            margin-bottom: 30px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 20px;
        }
        
        .content-title {
            font-size: 32px;
            font-weight: bold;
            color: #1a1a1a;
            margin: 0 0 10px 0;
        }
        
        .content-meta {
            color: #666;
            font-size: 14px;
        }
        
        .content-body {
            line-height: 1.6;
            color: #333;
        }
        
        /* Right Panel - Relationships */
        .right-panel {
            width: var(--right-width, 280px);
            min-width: 250px;
            max-width: 400px;
            background: white;
            border-left: 1px solid #dee2e6;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .panel-header {
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .panel-title {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        
        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        /* Relationship sections */
        .relationship-section {
            margin-bottom: 20px;
        }
        
        .relationship-header {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .relationship-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .relationship-item {
            padding: 6px 8px;
            margin-bottom: 2px;
            background: #f8f9fa;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            line-height: 1.3;
        }
        
        .relationship-item:hover {
            background: #e9ecef;
            transform: translateX(2px);
        }
        
        .relationship-item .doc-number {
            font-weight: 600;
            color: #0969da;
        }
        
        .relationship-item .doc-title {
            color: #333;
            display: block;
            font-size: 10px;
            margin-top: 1px;
        }
        
        /* Empty state */
        .empty-state {
            color: #999;
            font-size: 12px;
            font-style: italic;
            padding: 8px;
            text-align: center;
        }
        
        /* Grouped view */
        .decade-group {
            margin-bottom: 15px;
        }
        
        .decade-header {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .decade-header .arrow {
            margin-right: 5px;
            transition: transform 0.2s;
            font-size: 10px;
        }
        
        .decade-header.collapsed .arrow {
            transform: rotate(-90deg);
        }
        
        .decade-items {
            margin-left: 15px;
        }
        
        .decade-items.collapsed {
            display: none;
        }
        
        /* Number groupings */
        .number-group {
            margin-bottom: 15px;
        }
        
        .number-header {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .number-header .arrow {
            margin-right: 5px;
            transition: transform 0.2s;
            font-size: 10px;
        }
        
        .number-header.collapsed .arrow {
            transform: rotate(-90deg);
        }
        
        .number-items {
            margin-left: 15px;
        }
        
        .number-items.collapsed {
            display: none;
        }
        
        /* Document action buttons */
        .document-actions {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }
        
        .action-btn {
            width: 100%;
            padding: 8px 12px;
            margin: 6px 0;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: #f8f9fa;
            border-color: #0969da;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .action-btn.primary {
            background: #0969da;
            color: white;
            border-color: #0969da;
        }
        
        .action-btn.primary:hover {
            background: #0550ae;
        }
        
        /* Icon-only actions at top */
        .icon-actions {
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            margin-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .icon-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .icon-btn:hover {
            background: #f8f9fa;
            border-color: #0969da;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .icon-btn.primary {
            background: #0969da;
            color: white;
            border-color: #0969da;
        }
        
        .icon-btn.primary:hover {
            background: #0550ae;
        }
        
        /* Tooltips for icon buttons */
        .icon-btn {
            position: relative;
        }
        
        .icon-btn::after {
            content: attr(title);
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1000;
        }
        
        .icon-btn::before {
            content: '';
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            border: 4px solid transparent;
            border-bottom-color: #333;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1000;
        }
        
        .icon-btn:hover::after,
        .icon-btn:hover::before {
            opacity: 1;
        }
        
        /* Adjust tooltip positioning for edge buttons */
        .icon-btn:first-child::after {
            left: 0;
            transform: none;
        }
        
        .icon-btn:first-child::before {
            left: 12px;
            transform: none;
        }
        
        .icon-btn:last-child::after {
            right: 0;
            left: auto;
            transform: none;
        }
        
        .icon-btn:last-child::before {
            right: 12px;
            left: auto;
            transform: none;
        }
        
        /* Bottom actions - full buttons */
        .bottom-actions {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }
        
        .bottom-actions .action-btn {
            margin: 4px 0;
        }
        
        /* Collapsible sections */
        .collapsible h5 {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .collapse-toggle {
            font-size: 10px;
            transition: transform 0.2s;
            color: #666;
        }
        
        .collapsible.collapsed .collapse-toggle {
            transform: rotate(-90deg);
        }
        
        .collapsible.collapsed .relationship-list {
            display: none;
        }
        
        .collapsible h5:hover {
            background: rgba(0,0,0,0.05) !important;
            border-radius: 0 !important;
        }
        
        /* Count badges */
        .relationship-count {
            margin-left: auto;
            background: #666;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: 500;
            min-width: 16px;
            text-align: center;
        }
        
        .relationship-section.amendments .relationship-count {
            background: #d97706;
        }
        
        .relationship-section.references .relationship-count {
            background: #2563eb;
        }
        
        .relationship-section.interpretations .relationship-count {
            background: #9333ea;
        }
        
        .relationship-section.related .relationship-count {
            background: #059669;
        }
        
        /* Resize handles */
        .resize-handle {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 4px;
            cursor: col-resize;
            background: transparent;
            z-index: 10;
        }
        
        .resize-handle:hover {
            background: #0969da;
            opacity: 0.3;
        }
        
        .resize-handle.active {
            background: #0969da;
            opacity: 0.6;
        }
        
        .left-resize-handle {
            right: -2px;
        }
        
        .right-resize-handle {
            left: -2px;
        }
        
        /* Search highlighting */
        mark {
            background: #fff3cd;
            color: #856404;
            padding: 1px 2px;
            border-radius: 2px;
            font-weight: 500;
        }
        
        .search-count {
            font-size: 12px;
            color: #666;
            font-weight: normal;
        }
        
        .topic-tag {
            font-size: 10px;
            color: #6b7280;
            margin-top: 4px;
            padding: 2px 6px;
            background: #f3f4f6;
            border-radius: 3px;
            display: inline-block;
            width: fit-content;
        }
        
        /* No results state */
        .no-results {
            text-align: center;
            color: #999;
            padding: 40px 20px;
            font-style: italic;
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .container {
                gap: 0;
            }
            
            .left-sidebar {
                width: var(--left-width, 250px);
                min-width: 200px;
                max-width: 350px;
            }
            
            .right-panel {
                width: var(--right-width, 250px);
                min-width: 200px;
                max-width: 300px;
            }
        }
        
        @media (max-width: 900px) {
            body {
                padding: 10px;
            }
            
            .container {
                flex-direction: column;
                height: auto;
                min-height: 100vh;
            }
            
            .left-sidebar,
            .right-panel {
                width: 100%;
                min-width: auto;
                max-width: none;
                height: auto;
                min-height: 300px;
            }
            
            .main-content {
                width: 100%;
                order: 1;
            }
            
            .left-sidebar {
                order: 2;
                margin-top: 20px;
            }
            
            .right-panel {
                order: 3;
                margin-top: 20px;
            }
            
            /* Hide resize handles on mobile */
            .resize-handle {
                display: none;
            }
            
            /* Adjust sidebar content for mobile */
            .sidebar-header,
            .panel-header {
                padding: 12px;
            }
            
            .sidebar-content,
            .panel-content {
                padding: 12px;
            }
        }
        
        @media (max-width: 600px) {
            body {
                padding: 5px;
            }
            
            .sidebar-header,
            .panel-header {
                padding: 10px;
            }
            
            .sidebar-title,
            .panel-title {
                font-size: 14px;
            }
            
            .search-box {
                font-size: 14px;
                padding: 6px 8px;
            }
            
            .view-selector {
                grid-template-columns: 1fr 1fr;
                gap: 4px;
            }
            
            .view-btn {
                padding: 5px 8px;
                font-size: 11px;
            }
            
            .order-btn {
                padding: 5px 8px;
                font-size: 11px;
            }
            
            .control-label {
                font-size: 10px;
                margin-bottom: 3px;
            }
            
            .stats {
                font-size: 10px;
                padding-top: 8px;
            }
            
            /* Stack icon actions vertically on small screens */
            .icon-actions {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            
            .icon-btn {
                width: 100%;
                height: 36px;
                justify-content: flex-start;
                padding: 0 12px;
                gap: 8px;
            }
            
            .icon-btn::before,
            .icon-btn::after {
                display: none; /* Hide tooltips on mobile */
            }
            
            /* Show text labels on mobile icon buttons */
            .icon-btn[title="Search in Document"]:after {
                content: "Search in Document";
            }
            
            .icon-btn[title="Download Original"]:after {
                content: "Download Original";
            }
            
            .icon-btn[title="Copy Link"]:after {
                content: "Copy Link";
            }
        }
        
        /* Enhanced relationship type indicators */
        .relationship-section {
            margin-bottom: 16px;
        }
        
        .relationship-section.amendments h5,
        .relationship-section.amendments .relationship-list {
            border-left: 4px solid #d97706;
        }
        
        .relationship-section.references h5,
        .relationship-section.references .relationship-list {
            border-left: 4px solid #0969da;
        }
        
        .relationship-section.interpretations h5,
        .relationship-section.interpretations .relationship-list {
            border-left: 4px solid #7c3aed;
        }
        
        .relationship-section.related h5,
        .relationship-section.related .relationship-list {
            border-left: 4px solid #059669;
        }
        
        .relationship-section h5 {
            margin: 0;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 12px;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 0 !important;
        }
        
        .relationship-section.amendments h5 {
            background: #fef3c7;
            color: #92400e;
            border-radius: 0 !important;
        }
        
        .relationship-section.references h5 {
            background: #dbeafe;
            color: #1e40af;
            border-radius: 0 !important;
        }
        
        .relationship-section.interpretations h5 {
            background: #ede9fe;
            color: #6b21a8;
            border-radius: 0 !important;
        }
        
        .relationship-section.related h5 {
            background: #d1fae5;
            color: #065f46;
            border-radius: 0 !important;
        }
        
        /* Relationship type icons */
        .rel-icon {
            font-size: 14px;
        }
        
        /* Enhanced relationship items */
        .relationship-item {
            margin-bottom: 6px;
            border-radius: 4px;
            overflow: hidden;
            transition: all 0.2s;
        }
        
        .relationship-item:hover {
            transform: translateX(3px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .rel-link {
            display: block;
            padding: 10px 12px;
            background: #f8f9fa;
            border: 1px solid transparent;
            text-decoration: none;
            color: inherit;
            font-size: 12px;
            transition: all 0.2s;
            border-radius: 4px;
        }
        
        .rel-link:hover {
            background: white;
            border-color: #dee2e6;
            text-decoration: none;
        }
        
        .amendments .rel-link:hover {
            border-color: #d97706;
            box-shadow: 0 0 0 1px #d97706;
        }
        
        .references .rel-link:hover {
            border-color: #0969da;
            box-shadow: 0 0 0 1px #0969da;
        }
        
        .interpretations .rel-link:hover {
            border-color: #7c3aed;
            box-shadow: 0 0 0 1px #7c3aed;
        }
        
        .related .rel-link:hover {
            border-color: #059669;
            box-shadow: 0 0 0 1px #059669;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Left Sidebar -->
        <div class="left-sidebar" role="navigation" aria-label="Ordinances Navigation">
            <div class="sidebar-header">
                <div class="header-top">
                    <div class="sidebar-title">Ordinances</div>
                    <div class="order-icons-alt">
                        <button class="order-icon active" data-order="asc" title="Oldest First">‚ñ≤</button>
                        <button class="order-icon" data-order="desc" title="Newest First">‚ñº</button>
                    </div>
                </div>
                
                <!-- Search -->
                <input type="text" class="search-box" placeholder="Search ordinances..." id="searchBox" 
                       aria-label="Search ordinances" role="searchbox">
                
                <!-- View selector -->
                <div class="control-group">
                    <div class="control-label">View</div>
                    <div class="view-selector" role="tablist" aria-label="View options">
                        <button class="view-btn" data-view="numerical" role="tab" aria-selected="false">Numerical</button>
                        <button class="view-btn active" data-view="chronological" role="tab" aria-selected="true">Chronological</button>
                        <button class="view-btn" data-view="topical" role="tab" aria-selected="false">Topical</button>
                    </div>
                </div>
            </div>
            <div class="sidebar-content" id="sidebarContent">
                <ul class="nav-list" id="navList" role="list" aria-live="polite" 
                    aria-label="Ordinances list">
                    <!-- Items will be populated by JavaScript -->
                </ul>
            </div>
            <!-- Floating stats bar -->
            <div class="stats">
                Showing <span id="count">14</span> of 14 ordinances
            </div>
            <div class="resize-handle left-resize-handle" data-direction="left"></div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="content-header">
                <h1 class="content-title">Ordinance #70-2001 - WQRA</h1>
                <div class="content-meta">
                    Water Quality Resource Area Protection Ordinance<br>
                    Passed: November 8, 2001
                </div>
            </div>
            <div class="content-body">
                <h2>WATER QUALITY RESOURCE AREA PROTECTION</h2>
                <h3>ARTICLE 1. GENERAL</h3>
                <h4>1.1 Title</h4>
                <p>This ordinance shall be known as the City of Rivergrove Water Quality Resources Protection Ordinance and may be referred to herein as "this ordinance".</p>
                
                <h4>1.2 Purpose</h4>
                <p>The purpose of this ordinance is to protect and restore water quality resources and establish clear, objective development standards for properties that contain water quality resources or are adjacent to fish and wildlife habitat...</p>
                
                <h3>ARTICLE 2. DEFINITIONS</h3>
                <p>Unless specifically defined below, words or phrases used in this ordinance shall be interpreted to give them the same meaning as they have in common usage...</p>
                
                <p><em>(Document content continues...)</em></p>
            </div>
        </div>
        
        <!-- Right Panel -->
        <div class="right-panel" role="complementary" aria-label="Document Relationships">
            <div class="panel-header">
                <div class="panel-title">Document Relationships</div>
            </div>
            <div class="panel-content">
                <!-- Icon Actions Top -->
                <div class="icon-actions" role="toolbar" aria-label="Document actions">
                    <button class="icon-btn" title="Search in Document" aria-label="Search in Document">üîç</button>
                    <button class="icon-btn" title="Download Original" aria-label="Download Original PDF">üì•</button>
                    <button class="icon-btn" title="Copy Link" aria-label="Copy Link to Document">üîó</button>
                </div>
                
                <!-- Amendments -->
                <div class="relationship-section amendments collapsible">
                    <h5><span class="collapse-toggle">‚ñº</span><span class="rel-icon">‚ö°</span> Amended By<span class="relationship-count">1</span></h5>
                    <ul class="relationship-list">
                        <li class="relationship-item">
                            <a href="#" class="rel-link">
                                <span class="rel-number">#88-2017</span>
                                <span class="rel-title">Docks Amendment</span>
                                <span class="rel-year">(2017)</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- Interpretations -->
                <div class="relationship-section interpretations collapsible">
                    <h5><span class="collapse-toggle">‚ñº</span><span class="rel-icon">‚öñÔ∏è</span> Interpretations<span class="relationship-count">2</span></h5>
                    <ul class="relationship-list">
                        <li class="relationship-item">
                            <a href="#" class="rel-link">
                                <span class="rel-number">2002-08-05</span>
                                <span class="rel-title">Lots Partially in Floodplain</span>
                                <span class="rel-year">(Aug 2002)</span>
                            </a>
                        </li>
                        <li class="relationship-item">
                            <a href="#" class="rel-link">
                                <span class="rel-number">1998-03-02</span>
                                <span class="rel-title">Section 5.080 Setbacks</span>
                                <span class="rel-year">(Mar 1998)</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- References This Document -->
                <div class="relationship-section references collapsible">
                    <h5><span class="collapse-toggle">‚ñº</span><span class="rel-icon">üìã</span> Referenced By<span class="relationship-count">2</span></h5>
                    <ul class="relationship-list">
                        <li class="relationship-item">
                            <a href="#" class="rel-link">
                                <span class="rel-number">#71-2002</span>
                                <span class="rel-title">Gates Ordinance</span>
                                <span class="rel-year">(2002)</span>
                            </a>
                        </li>
                        <li class="relationship-item">
                            <a href="#" class="rel-link">
                                <span class="rel-number">#72-2002</span>
                                <span class="rel-title">Penalties & Abatement</span>
                                <span class="rel-year">(2002)</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- Related Documents -->
                <div class="relationship-section related collapsible">
                    <h5><span class="collapse-toggle">‚ñº</span><span class="rel-icon">üîó</span> Related Documents<span class="relationship-count">3</span></h5>
                    <ul class="relationship-list">
                        <li class="relationship-item">
                            <a href="#" class="rel-link">
                                <span class="rel-number">#52-1987</span>
                                <span class="rel-title">Flood Damage Prevention</span>
                                <span class="rel-year">(1987)</span>
                            </a>
                        </li>
                        <li class="relationship-item">
                            <a href="#" class="rel-link">
                                <span class="rel-number">#62-1998</span>
                                <span class="rel-title">Flood & Land Development</span>
                                <span class="rel-year">(1998)</span>
                            </a>
                        </li>
                        <li class="relationship-item">
                            <a href="#" class="rel-link">
                                <span class="rel-number">#68-2000</span>
                                <span class="rel-title">Metro Compliance</span>
                                <span class="rel-year">(2000)</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- Bottom Actions -->
                <div class="bottom-actions">
                    <button class="action-btn primary">
                        <span>üîç</span> Search in Document
                    </button>
                    <button class="action-btn">
                        <span>üì•</span> Download Original
                    </button>
                    <button class="action-btn">
                        <span>üîó</span> Copy Link
                    </button>
                </div>
            </div>
            <div class="resize-handle right-resize-handle" data-direction="right"></div>
        </div>
    </div>
    
    <script>
        // Sample data
        const ordinances = [
            {num: '16', year: '1974', title: 'Parks Advisory Council', topic: 'Parks & Recreation'},
            {num: '28', year: '1978', title: 'Parks Amendment', topic: 'Parks & Recreation'},
            {num: '52', year: '1987', title: 'Flood Prevention', topic: 'Environmental'},
            {num: '57-93', year: '1993', title: 'Manufactured Homes', topic: 'Housing'},
            {num: '59-97A', year: '1998', title: 'Land Development', topic: 'Development'},
            {num: '61-98', year: '1998', title: 'Land Development Amendment', topic: 'Development'},
            {num: '62-98', year: '1998', title: 'Flood & Land Development', topic: 'Environmental'},
            {num: '68-2000', year: '2000', title: 'Metro Compliance', topic: 'Compliance'},
            {num: '69-2000', year: '2000', title: 'Title 3 Compliance', topic: 'Compliance'},
            {num: '70-2001', year: '2001', title: 'WQRA', topic: 'Environmental', active: true},
            {num: '71-2002', year: '2002', title: 'Gates', topic: 'Development'},
            {num: '72-2002', year: '2002', title: 'Penalties & Abatement', topic: 'Enforcement'},
            {num: '73-2003A', year: '2003', title: 'Conditional Use', topic: 'Development'},
            {num: '88-2017', year: '2017', title: 'Docks', topic: 'Environmental'}
        ];
        
        let currentView = 'chronological';
        let currentOrder = 'asc';
        let searchTerm = '';
        
        // Render chronological view (with decade groupings)
        function renderChronological() {
            const filtered = filterOrdinances();
            const grouped = {};
            
            filtered.forEach(ord => {
                const decade = Math.floor(ord.year / 10) * 10;
                const key = `${decade}s`;
                if (!grouped[key]) grouped[key] = [];
                grouped[key].push(ord);
            });
            
            const html = Object.keys(grouped).sort().map(decade => `
                <div class="decade-group">
                    <div class="decade-header" onclick="toggleDecade(this)">
                        <span class="arrow">‚ñº</span> ${decade}
                    </div>
                    <div class="decade-items">
                        <ul class="nav-list">
                            ${grouped[decade].map(ord => `
                                <li class="${ord.active ? 'active' : ''}">
                                    <div style="display: flex; align-items: center; width: 100%;">
                                        <span class="number">#${highlightSearchTerms(ord.num, searchTerm)}</span>
                                        <span>${highlightSearchTerms(ord.title, searchTerm)}</span>
                                        <span class="year-tag">${highlightSearchTerms(ord.year, searchTerm)}</span>
                                    </div>
                                    ${ord.topic ? `<div class="topic-tag">${highlightSearchTerms(ord.topic, searchTerm)}</div>` : ''}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('sidebarContent').innerHTML = html;
            updateSearchResultCount();
            addListNavigation(); // Re-add keyboard navigation after DOM update
        }
        
        // Old renderByDecade - no longer needed
        function renderByDecade() {
            const filtered = filterOrdinances();
            const grouped = {};
            
            filtered.forEach(ord => {
                const decade = Math.floor(ord.year / 10) * 10;
                const key = `${decade}s`;
                if (!grouped[key]) grouped[key] = [];
                grouped[key].push(ord);
            });
            
            const html = Object.keys(grouped).sort().map(decade => `
                <div class="decade-group">
                    <div class="decade-header" onclick="toggleDecade(this)">
                        <span class="arrow">‚ñº</span> ${decade}
                    </div>
                    <div class="decade-items">
                        <ul class="nav-list">
                            ${grouped[decade].map(ord => `
                                <li class="${ord.active ? 'active' : ''}">
                                    <div style="display: flex; align-items: center; width: 100%;">
                                        <span class="number">#${highlightSearchTerms(ord.num, searchTerm)}</span>
                                        <span>${highlightSearchTerms(ord.title, searchTerm)}</span>
                                        <span class="year-tag">${highlightSearchTerms(ord.year, searchTerm)}</span>
                                    </div>
                                    ${ord.topic ? `<div class="topic-tag">${highlightSearchTerms(ord.topic, searchTerm)}</div>` : ''}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('sidebarContent').innerHTML = html;
        }
        
        // Render topical view
        function renderTopical() {
            const filtered = filterOrdinances();
            const grouped = {};
            
            filtered.forEach(ord => {
                if (!grouped[ord.topic]) grouped[ord.topic] = [];
                grouped[ord.topic].push(ord);
            });
            
            const html = Object.keys(grouped).sort().map(topic => `
                <div class="decade-group">
                    <div class="decade-header" onclick="toggleDecade(this)">
                        <span class="arrow">‚ñº</span> ${topic}
                    </div>
                    <div class="decade-items">
                        <ul class="nav-list">
                            ${grouped[topic].map(ord => `
                                <li class="${ord.active ? 'active' : ''}">
                                    <span class="number">#${ord.num}</span>
                                    <span>${ord.title}</span>
                                    <span class="year-tag">${ord.year}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('sidebarContent').innerHTML = html;
            updateSearchResultCount();
            addListNavigation(); // Re-add keyboard navigation after DOM update
        }
        
        // Render numerical view
        function renderNumerical() {
            const filtered = filterOrdinances();
            const grouped = {
                '1-25': [],
                '26-50': [],
                '51-75': [],
                '76+': []
            };
            
            filtered.forEach(ord => {
                const num = parseInt(ord.num);
                if (num <= 25) {
                    grouped['1-25'].push(ord);
                } else if (num <= 50) {
                    grouped['26-50'].push(ord);
                } else if (num <= 75) {
                    grouped['51-75'].push(ord);
                } else {
                    grouped['76+'].push(ord);
                }
            });
            
            const html = Object.keys(grouped).map(range => {
                if (grouped[range].length === 0) return '';
                return `
                    <div class="number-group">
                        <div class="number-header" onclick="toggleDecade(this)">
                            <span class="arrow">‚ñº</span> Ordinances ${range}
                        </div>
                        <div class="number-items">
                            <ul class="nav-list">
                                ${grouped[range].map(ord => `
                                    <li class="${ord.active ? 'active' : ''}">
                                        <div style="display: flex; align-items: center; width: 100%;">
                                            <span class="number">#${highlightSearchTerms(ord.num, searchTerm)}</span>
                                            <span>${highlightSearchTerms(ord.title, searchTerm)}</span>
                                            <span class="year-tag">${highlightSearchTerms(ord.year, searchTerm)}</span>
                                        </div>
                                        ${ord.topic ? `<div class="topic-tag">${highlightSearchTerms(ord.topic, searchTerm)}</div>` : ''}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('sidebarContent').innerHTML = html || '<div class="no-results">No ordinances found</div>';
            updateSearchResultCount();
            addListNavigation(); // Re-add keyboard navigation after DOM update
        }
        
        // Filter and sort ordinances
        function filterOrdinances() {
            let filtered = ordinances;
            
            // Apply search filter
            if (searchTerm) {
                filtered = filtered.filter(ord => 
                    ord.num.toLowerCase().includes(searchTerm) ||
                    ord.title.toLowerCase().includes(searchTerm) ||
                    ord.year.includes(searchTerm) ||
                    (ord.topic && ord.topic.toLowerCase().includes(searchTerm))
                );
            }
            
            // Apply sorting
            const sorted = [...filtered].sort((a, b) => {
                if (currentOrder === 'asc') {
                    return parseInt(a.year) - parseInt(b.year);
                } else {
                    return parseInt(b.year) - parseInt(a.year);
                }
            });
            
            return sorted;
        }
        
        // Highlight search terms in text
        function highlightSearchTerms(text, searchTerm) {
            if (!searchTerm) return text;
            
            const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }
        
        // Update stats display
        function updateSearchResultCount() {
            const filtered = filterOrdinances();
            const countElement = document.getElementById('count');
            const statsElement = document.querySelector('.stats');
            
            if (countElement) {
                countElement.textContent = filtered.length;
            }
            
            if (statsElement) {
                if (searchTerm) {
                    statsElement.innerHTML = `Showing <span id="count">${filtered.length}</span> of ${ordinances.length} ordinances (filtered)`;
                } else {
                    statsElement.innerHTML = `Showing <span id="count">${filtered.length}</span> of ${ordinances.length} ordinances`;
                }
            }
        }
        
        // Toggle decade/topic group
        function toggleDecade(header) {
            header.classList.toggle('collapsed');
            header.nextElementSibling.classList.toggle('collapsed');
        }
        
        // Event handlers for View buttons
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentView = e.target.dataset.view;
                updateTabManagement(); // Update ARIA attributes
                
                // No need to reset sidebar since all views use similar structure
                
                switch(currentView) {
                    case 'chronological':
                        renderChronological();
                        break;
                    case 'topical':
                        renderTopical();
                        break;
                    case 'numerical':
                        renderNumerical();
                        break;
                }
            });
        });
        
        // Event handlers for Order icons (works for both placements)
        document.querySelectorAll('.order-icon, .order-icons-alt .order-icon').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const target = e.target.closest('.order-icon');
                if (!target) return;
                
                document.querySelectorAll('.order-icon, .order-icons-alt .order-icon').forEach(b => b.classList.remove('active'));
                target.classList.add('active');
                currentOrder = target.dataset.order;
                
                // Re-render current view with new order
                switch(currentView) {
                    case 'chronological':
                        renderChronological();
                        break;
                    case 'topical':
                        renderTopical();
                        break;
                    case 'numerical':
                        renderNumerical();
                        break;
                }
            });
        });
        
        document.getElementById('searchBox').addEventListener('input', (e) => {
            searchTerm = e.target.value.toLowerCase();
            
            switch(currentView) {
                case 'list':
                    renderList();
                    break;
                case 'decade':
                    renderByDecade();
                    break;
                case 'topic':
                    renderByTopic();
                    break;
            }
        });
        
        // Action button functionality
        document.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const text = this.textContent.trim();
                
                // Add click animation
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
                
                // Show feedback based on button type
                if (text.includes('View Full Document')) {
                    showNotification('üìÑ Opening full document...', 'info');
                } else if (text.includes('Download PDF')) {
                    showNotification('üì• Downloading PDF...', 'success');
                } else if (text.includes('Copy Link')) {
                    showNotification('üîó Link copied to clipboard!', 'success');
                    // Simulate copying to clipboard
                    navigator.clipboard?.writeText(window.location.href);
                } else if (text.includes('Search in Document')) {
                    showNotification('üîç Opening document search...', 'info');
                }
            });
        });
        
        // Notification system
        function showNotification(message, type = 'info') {
            // Remove existing notification
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 500;
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                ${type === 'success' ? 'background: #10b981; color: white;' : 'background: #3b82f6; color: white;'}
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in forwards';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Add keyframes for notification animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // Initial render
        renderChronological();
        
        // Collapse functionality for relationship sections
        document.querySelectorAll('.collapsible h5').forEach(header => {
            header.addEventListener('click', function() {
                const section = this.parentElement;
                section.classList.toggle('collapsed');
            });
        });
        
        // Resizable panels functionality
        let isResizing = false;
        let currentHandle = null;
        let startX = 0;
        let startWidth = 0;
        
        // Load saved widths from localStorage
        const savedLeftWidth = localStorage.getItem('leftPanelWidth');
        const savedRightWidth = localStorage.getItem('rightPanelWidth');
        
        if (savedLeftWidth) {
            document.documentElement.style.setProperty('--left-width', savedLeftWidth + 'px');
        }
        if (savedRightWidth) {
            document.documentElement.style.setProperty('--right-width', savedRightWidth + 'px');
        }
        
        document.querySelectorAll('.resize-handle').forEach(handle => {
            handle.addEventListener('mousedown', function(e) {
                isResizing = true;
                currentHandle = this;
                startX = e.clientX;
                
                const panel = this.parentElement;
                startWidth = panel.offsetWidth;
                
                this.classList.add('active');
                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';
                
                e.preventDefault();
            });
        });
        
        document.addEventListener('mousemove', function(e) {
            if (!isResizing || !currentHandle) return;
            
            const direction = currentHandle.dataset.direction;
            const panel = currentHandle.parentElement;
            const deltaX = e.clientX - startX;
            
            let newWidth;
            if (direction === 'left') {
                newWidth = startWidth + deltaX;
            } else {
                newWidth = startWidth - deltaX;
            }
            
            // Apply min/max constraints
            const minWidth = direction === 'left' ? 200 : 250;
            const maxWidth = direction === 'left' ? 500 : 400;
            newWidth = Math.max(minWidth, Math.min(maxWidth, newWidth));
            
            // Update CSS variable
            const cssVar = direction === 'left' ? '--left-width' : '--right-width';
            document.documentElement.style.setProperty(cssVar, newWidth + 'px');
        });
        
        document.addEventListener('mouseup', function() {
            if (!isResizing || !currentHandle) return;
            
            const direction = currentHandle.dataset.direction;
            const panel = currentHandle.parentElement;
            const newWidth = panel.offsetWidth;
            
            // Save to localStorage
            const storageKey = direction === 'left' ? 'leftPanelWidth' : 'rightPanelWidth';
            localStorage.setItem(storageKey, newWidth);
            
            isResizing = false;
            currentHandle.classList.remove('active');
            currentHandle = null;
            document.body.style.cursor = '';
            document.body.style.userSelect = '';
        });
        
        // Keyboard shortcuts for search
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + K to focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchBox = document.getElementById('searchBox');
                searchBox.focus();
                searchBox.select();
            }
            
            // Escape to clear search
            if (e.key === 'Escape' && document.activeElement === document.getElementById('searchBox')) {
                const searchBox = document.getElementById('searchBox');
                searchBox.value = '';
                searchTerm = '';
                
                // Re-render current view
                switch(currentView) {
                    case 'chronological':
                        renderChronological();
                        break;
                    case 'topical':
                        renderTopical();
                        break;
                    case 'numerical':
                        renderNumerical();
                        break;
                }
                searchBox.blur();
            }
        });
        
        // Keyboard navigation and accessibility improvements
        let currentFocusIndex = -1;
        
        // Tab management for view controls
        document.querySelectorAll('.view-btn').forEach((btn, index) => {
            btn.addEventListener('keydown', function(e) {
                const buttons = Array.from(document.querySelectorAll('.view-btn'));
                let newIndex;
                
                switch(e.key) {
                    case 'ArrowLeft':
                        e.preventDefault();
                        newIndex = index > 0 ? index - 1 : buttons.length - 1;
                        buttons[newIndex].focus();
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        newIndex = index < buttons.length - 1 ? index + 1 : 0;
                        buttons[newIndex].focus();
                        break;
                    case 'Home':
                        e.preventDefault();
                        buttons[0].focus();
                        break;
                    case 'End':
                        e.preventDefault();
                        buttons[buttons.length - 1].focus();
                        break;
                }
            });
        });
        
        // Arrow key navigation for ordinances list
        function addListNavigation() {
            const listItems = document.querySelectorAll('#navList li, .decade-item, .topic-item');
            
            listItems.forEach((item, index) => {
                item.setAttribute('tabindex', index === 0 ? '0' : '-1');
                item.setAttribute('role', 'listitem');
                
                item.addEventListener('keydown', function(e) {
                    let newIndex;
                    
                    switch(e.key) {
                        case 'ArrowDown':
                            e.preventDefault();
                            newIndex = Math.min(index + 1, listItems.length - 1);
                            focusListItem(listItems, newIndex);
                            break;
                        case 'ArrowUp':
                            e.preventDefault();
                            newIndex = Math.max(index - 1, 0);
                            focusListItem(listItems, newIndex);
                            break;
                        case 'Home':
                            e.preventDefault();
                            focusListItem(listItems, 0);
                            break;
                        case 'End':
                            e.preventDefault();
                            focusListItem(listItems, listItems.length - 1);
                            break;
                        case 'Enter':
                        case ' ':
                            e.preventDefault();
                            // Simulate click on the item
                            item.click();
                            break;
                    }
                });
                
                item.addEventListener('focus', function() {
                    currentFocusIndex = index;
                });
            });
        }
        
        function focusListItem(items, index) {
            // Remove tabindex from all items
            items.forEach(item => item.setAttribute('tabindex', '-1'));
            // Set tabindex and focus on target item
            items[index].setAttribute('tabindex', '0');
            items[index].focus();
            currentFocusIndex = index;
        }
        
        // Update tab management when view changes
        function updateTabManagement() {
            const activeBtn = document.querySelector('.view-btn.active');
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.setAttribute('aria-selected', btn === activeBtn ? 'true' : 'false');
                btn.setAttribute('tabindex', btn === activeBtn ? '0' : '-1');
            });
        }
        
        // Focus management for collapsible sections
        document.addEventListener('click', function(e) {
            if (e.target.matches('.collapsible h5') || e.target.closest('.collapsible h5')) {
                const header = e.target.matches('.collapsible h5') ? e.target : e.target.closest('.collapsible h5');
                const section = header.parentElement;
                const isCollapsed = section.classList.contains('collapsed');
                
                // Update ARIA attributes
                header.setAttribute('aria-expanded', isCollapsed ? 'true' : 'false');
                const list = section.querySelector('.relationship-list');
                if (list) {
                    list.setAttribute('aria-hidden', isCollapsed ? 'false' : 'true');
                }
            }
        });
        
        // Add ARIA attributes to collapsible sections
        document.querySelectorAll('.collapsible h5').forEach(header => {
            header.setAttribute('role', 'button');
            header.setAttribute('aria-expanded', 'true');
            header.setAttribute('tabindex', '0');
            header.setAttribute('aria-controls', header.parentElement.id || 'relationship-content');
            
            // Add keyboard support for collapsible headers
            header.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.click();
                }
            });
        });
    </script>
</body>
</html>